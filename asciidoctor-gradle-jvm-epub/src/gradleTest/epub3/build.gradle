plugins {
    id 'org.asciidoctor.jvm.epub'
}

apply from: "${System.getProperty('OFFLINE_REPO')}/repositories.gradle"


asciidoctorEpub {
    ebookFormats = [EPUB3]

    sources {
        include 'epub3.adoc'
    }

    inProcess IN_PROCESS
}

task runGradleTest {
    dependsOn asciidoctorEpub
}


// This is to work around a bug in Gradle. It is not part of normal build script.
// The side affect of this is that we actually get better code coverage as the process mode
// changes depending on which version of Gradle is being tested.
if(System.getProperty('CALLING_GRADLETEST_USES_GROOVY_VERSION') != GroovySystem.version) {
    asciidoctor {
        inProcess JAVA_EXEC
    }
}